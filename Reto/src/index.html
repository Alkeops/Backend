<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>El Commerce</title>
  </head>
  <body
    style="
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      flex-direction: column;
      background: #383838;
    "
  >
    <h1 style="color: white; font-family: Arial, Helvetica, sans-serif">
      Agregar producto
    </h1>
    <form
      id="form"
      style="
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        font-family: sans-serif;
      "
    >
      <input
        id="title"
        type="text"
        name="title"
        style="
          margin-top: 10px;
          margin-bottom: 10px;
          padding: 10px;
          border-radius: 5px;
          border: 1px solid white;
          width: 300px;
        "
      />
      <input
        id="price"
        type="text"
        name="price"
        style="
          margin-top: 10px;
          margin-bottom: 10px;
          padding: 10px;
          border-radius: 5px;
          border: 1px solid white;
          width: 300px;
        "
      />
      <input
        id="thumbnail"
        type="text"
        name="thumbnail"
        style="
          margin-top: 10px;
          margin-bottom: 20px;
          padding: 10px;
          border-radius: 5px;
          border: 1px solid white;
          width: 300px;
        "
      />
      <button
        id="button"
        style="
          display: flex;
          align-items: center;
          justify-content: center;
          border-radius: 10px;
          color: white;
          background: black;
          border: none;
          min-width: 60%;
          height: 60px;
          font-size: 16px;
        "
      >
        Enviar
      </button>
    </form>
    <script>
      const form = document.querySelector("#form");
      const button = document.querySelector("#button");
      const title = document.querySelector("#title");
      const price = document.querySelector("#price");
      const thumbnail = document.querySelector("#thumbnail");
      const url = "http://127.0.0.1:8080/api/productos";

      let data = {};

      const saveInData = ({ target: { value, name } }) => {
        data = {
          ...data,
          [name]: value,
        };
      };
      const pedirData = async () => {
        const request = await fetch(url);
        const dataFromDb = await request.json();
        console.log(dataFromDb);
      };

      const api = async (data) => {
        const send = await fetch(url, {
          method: "POST",
          headers: {
            Accept: "application/json",
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
        });
        const response = await send.json();
        title.value = "";
        price.value = "";
        thumbnail.value = "";
        console.log(response);
      };

      setInterval(() => pedirData(), 10000);

      window.onload = () => pedirData();
      title.addEventListener("change", (e) => saveInData(e));
      price.addEventListener("change", (e) => saveInData(e));
      thumbnail.addEventListener("change", (e) => saveInData(e));
      form.addEventListener("submit", (e) => {
        e.preventDefault();
        return false;
      });
      button.addEventListener("click", () => api(data));
    </script>
  </body>
</html>
